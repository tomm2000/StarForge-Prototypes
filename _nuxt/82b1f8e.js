(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{231:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},232:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(31),o=n(234);function c(e,t){if(t&&("object"===Object(r.a)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(o.a)(e)}},233:function(e,t,n){"use strict";function r(e,p){return r=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e},r(e,p)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}n.d(t,"a",(function(){return o}))},234:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},235:function(e,t,n){var r=n(3);e.exports=r(1..valueOf)},236:function(e,t,n){var r=n(6),o=n(21),c=n(58),l=n(297),h=n(181),f=n(8),v=n(14),d=n(46),m=n(4),y=o("Reflect","construct"),_=Object.prototype,x=[].push,O=m((function(){function e(){}return!(y((function(){}),[],e)instanceof e)})),k=!m((function(){y((function(){}))})),w=O||k;r({target:"Reflect",stat:!0,forced:w,sham:w},{construct:function(e,t){h(e),f(t);var n=arguments.length<3?e:h(arguments[2]);if(k&&!O)return y(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return c(x,r,t),new(c(l,e,r))}var o=n.prototype,m=d(v(o)?o:_),w=c(e,m,t);return v(w)?w:m}})},237:function(e,t,n){n(271)("Float32",(function(e){return function(data,t,n){return e(this,data,t,n)}}))},238:function(e,t,n){"use strict";var r=n(6),o=n(1),c=n(3),l=n(44),h=n(235),f=n(179),v=n(4),d=o.RangeError,m=o.String,y=Math.floor,_=c(f),x=c("".slice),O=c(1..toFixed),k=function(e,t,n){return 0===t?n:t%2==1?k(e,t-1,n*e):k(e*e,t/2,n)},w=function(data,e,t){for(var n=-1,r=t;++n<6;)r+=e*data[n],data[n]=r%1e7,r=y(r/1e7)},E=function(data,e){for(var t=6,n=0;--t>=0;)n+=data[t],data[t]=y(n/e),n=n%e*1e7},j=function(data){for(var e=6,s="";--e>=0;)if(""!==s||0===e||0!==data[e]){var t=m(data[e]);s=""===s?t:s+_("0",7-t.length)+t}return s};r({target:"Number",proto:!0,forced:v((function(){return"0.000"!==O(8e-5,3)||"1"!==O(.9,0)||"1.25"!==O(1.255,2)||"1000000000000000128"!==O(0xde0b6b3a7640080,0)}))||!v((function(){O({})}))},{toFixed:function(e){var t,n,r,o,c=h(this),f=l(e),data=[0,0,0,0,0,0],v="",y="0";if(f<0||f>20)throw d("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return m(c);if(c<0&&(v="-",c=-c),c>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(c*k(2,69,1))-69)<0?c*k(2,-t,1):c/k(2,t,1),n*=4503599627370496,(t=52-t)>0){for(w(data,0,n),r=f;r>=7;)w(data,1e7,0),r-=7;for(w(data,k(10,r,1),0),r=t-1;r>=23;)E(data,1<<23),r-=23;E(data,1<<r),w(data,1,1),E(data,2),y=j(data)}else w(data,0,n),w(data,1<<-t,0),y=j(data)+_("0",f);return y=f>0?v+((o=y.length)<=f?"0."+_("0",f-o)+y:x(y,0,o-f)+"."+x(y,o-f)):v+y}})},265:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(108);var o=n(137),c=n(75);function l(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(o.a)(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},274:function(e,t,n){"use strict";var r=n(11),o=n(1),c=n(3),l=n(103),h=n(16),f=n(13),v=n(178),d=n(35),m=n(104),y=n(180),_=n(4),x=n(67).f,O=n(28).f,k=n(15).f,w=n(235),E=n(275).trim,j="Number",T=o.Number,R=T.prototype,C=o.TypeError,M=c("".slice),I=c("".charCodeAt),A=function(e){var t=y(e,"number");return"bigint"==typeof t?t:U(t)},U=function(e){var t,n,r,o,c,l,h,code,f=y(e,"number");if(m(f))throw C("Cannot convert a Symbol value to a number");if("string"==typeof f&&f.length>2)if(f=E(f),43===(t=I(f,0))||45===t){if(88===(n=I(f,2))||120===n)return NaN}else if(48===t){switch(I(f,1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+f}for(l=(c=M(f,2)).length,h=0;h<l;h++)if((code=I(c,h))<48||code>o)return NaN;return parseInt(c,r)}return+f};if(l(j,!T(" 0o1")||!T("0b1")||T("+0x1"))){for(var S,P=function(e){var t=arguments.length<1?0:T(A(e)),n=this;return d(R,n)&&_((function(){w(n)}))?v(Object(t),n,P):t},D=r?x(T):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),F=0;D.length>F;F++)f(T,S=D[F])&&!f(P,S)&&k(P,S,O(T,S));P.prototype=R,R.constructor=P,h(o,j,P)}},275:function(e,t,n){var r=n(3),o=n(20),c=n(12),l=n(276),h=r("".replace),f="["+l+"]",v=RegExp("^"+f+f+"*"),d=RegExp(f+f+"*$"),m=function(e){return function(t){var n=c(o(t));return 1&e&&(n=h(n,v,"")),2&e&&(n=h(n,d,"")),n}};e.exports={start:m(1),end:m(2),trim:m(3)}},276:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},297:function(e,t,n){"use strict";var r=n(1),o=n(3),c=n(53),l=n(14),h=n(13),f=n(69),v=n(73),d=r.Function,m=o([].concat),y=o([].join),_={},x=function(e,t,n){if(!h(_,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";_[t]=d("C,a","return new C("+y(r,",")+")")}return _[t](e,n)};e.exports=v?d.bind:function(e){var t=c(this),n=t.prototype,r=f(arguments,1),o=function(){var n=m(r,f(arguments));return this instanceof o?x(t,n.length,n):t.apply(e,n)};return l(n)&&(o.prototype=n),o}},299:function(e,t,n){"use strict";n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return y}));var r,o,c,l=n(327),h=n(339),f=n(302),v={apiKey:"AIzaSyBRZAUAtiRRsPyy5draej0YnelSnto8IOk",authDomain:"starforge-3b903.firebaseapp.com",projectId:"starforge-3b903",storageBucket:"starforge-3b903.appspot.com",messagingSenderId:"1078095247446",appId:"1:1078095247446:web:68e4bf8be2ab92379ea3f7",measurementId:"G-T9QPLR9C9F"},d=!1;function m(){d||(r=Object(l.a)(v),o=Object(h.a)(r),c=Object(f.b)(),d=!0)}function y(){if(!d)throw"firebase not initialized!";return{app:r,analytics:o,storage:c}}},328:function(e,t,n){var content=n(364);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(100).default)("19f6cc7a",content,!0,{sourceMap:!1})},363:function(e,t,n){"use strict";n(328)},364:function(e,t,n){var r=n(99)(!1);r.push([e.i,".main_container[data-v-62c4645f]{background:#13131a;display:grid;grid-template-rows:1fr 15fr 1fr;grid-template-columns:5rem auto;padding:2%;height:100vh;width:100vw}.main_container .home-link-wrap[data-v-62c4645f]{grid-row:1;grid-column:1/3;display:flex;align-items:center}.main_container .home-link-wrap a[data-v-62c4645f]{color:#fff}.main_container .fps-wrap[data-v-62c4645f]{grid-row:3;grid-column:1;display:flex;align-items:center;color:#fff}.main_container .upload-wrap[data-v-62c4645f]{grid-row:3;grid-column:2;display:flex;align-items:center;color:#fff}.main_container .canvas-wrap[data-v-62c4645f]{grid-row:2;grid-column:1/3;height:100%;overflow:hidden}.main_container .canvas-wrap .canvas[data-v-62c4645f]{height:100%;width:100%;border:2px solid #fff}",""]),e.exports=r},406:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n(131),c=n(132),l=(n(238),n(19),n(33),n(230)),h=n(10),f=(n(66),n(59),n(270)),v=(n(45),n(39),n(302)),d=n(299);function m(){return y.apply(this,arguments)}function y(){return(y=Object(h.a)(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(d.a)(),n=t.storage,r=Object(v.d)(n,"planet_schematics"),e.next=4,Object(v.c)(r);case 4:return o=e.sent,e.abrupt("return",o.items.map((function(e){return e.name})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return x.apply(this,arguments)}function x(){return(x=Object(h.a)(regeneratorRuntime.mark((function e(t){var n,r,o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.d)(Object(d.a)().storage,"planet_schematics/".concat(t)),e.next=3,Object(v.a)(n);case 3:return r=e.sent,e.next=6,fetch(r);case 6:return o=e.sent,e.next=9,o.json();case 9:return data=e.sent,e.abrupt("return",JSON.stringify(data));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(54),n(274),n(239),n(237),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262);var O=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,r=arguments.length>2?arguments[2]:void 0;Object(o.a)(this,e),this.last_radius=1,this.resolution=10,this.parent=r,this.resolution=n,this.scene=t,this.mesh=this.generateNewMesh()}return Object(c.a)(e,[{key:"getResolution",value:function(){return this.resolution}},{key:"setResolution",value:function(e){this.resolution=e,this.generateNewMesh()}},{key:"updateMesh",value:function(){var e=this;if(this.mesh&&this.originalPositionData&&this.originalElevationData&&this.gpu_init){var t=this.originalPositionData,n=this.originalElevationData;this.mesh.updateMeshPositions((function(data){var r=e.parent.getDataController().getNoiseController(),o=e.parent.getDataController().getRadius(),c=e.parent.getDataController().getScale();r.isElevationDataInitialized()?r.applyLayers():r.applyLayers(n.slice(),t.slice());for(var l=r.getLayerData(),h=Number.MIN_VALUE,f=Number.MAX_VALUE,i=0;i<l.length/4;i++){var v=(o-1+l[4*i+3])*c;data[3*i+0]=t[4*i+0]*v,data[3*i+1]=t[4*i+1]*v,data[3*i+2]=t[4*i+2]*v,h=Math.max(h,v),f=Math.min(f,v)}e.parent.getDataController().setMinMaxHeight(f,h)}),!0),this.materialID=this.parent.getDataController().updateMeshMaterial(this.mesh,this.materialID)}}},{key:"generateNewMesh",value:function(){var e;null===(e=this.mesh)||void 0===e||e.dispose(),this.mesh=l.MeshBuilder.CreateIcoSphere("icosphere",{subdivisions:this.resolution,updatable:!0,flat:!1},this.scene),this.mesh.forceSharedVertices();var data=this.mesh.getVerticesData("position");if(!data)throw"error in the mesh position data!";var t=data.length/3*4;this.originalPositionData=new Float32Array(t),this.originalElevationData=new Float32Array(t);for(var i=0;i<data.length/3;i++)this.originalPositionData[4*i+0]=data[3*i+0],this.originalPositionData[4*i+1]=data[3*i+1],this.originalPositionData[4*i+2]=data[3*i+2],this.originalElevationData[4*i+2]=1,this.originalElevationData[4*i+3]=1;for(var n=Math.floor(Math.sqrt(t/4));t/4%n!=0;)n-=1;return this.meshImageRoot=n,this.gpu_init={width:t/4/this.meshImageRoot,height:this.meshImageRoot},this.parent.getDataController().getNoiseController().setGPUSpecs(this.gpu_init),this.mesh}},{key:"dispose",value:function(){this.mesh.dispose()}}]),e}();function k(e){if(e)if(e.parent)k(e.parent);else try{e.destroy()}catch(e){}}n(55),n(42),n(26),n(34),n(56),n(57),n(43);function w(){return(w=Object(h.a)(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(d.a)(),n=t.storage,r=Object(v.d)(n,"planet_materials"),e.next=4,Object(v.c)(r);case 4:return o=e.sent,e.abrupt("return",o.items.map((function(e){return e.name})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=Object(h.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.d)(Object(d.a)().storage,"planet_materials/".concat(t)),e.next=3,Object(v.a)(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,n){if(e&&e instanceof l.NodeMaterial){var r=e.getBlockByName(t);if(r&&r instanceof l.InputBlock)return r.value=n,e}}function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var C=function(){function e(t){Object(o.a)(this,e),this.id=Math.random(),this.gui=void 0,this._materialName="",this.scene=t,this.properties={src:{type:"none",value:""}}}var t,n,r;return Object(c.a)(e,[{key:"materialName",get:function(){return this._materialName},set:function(e){var t=this;(function(e){return E.apply(this,arguments)})(e).then((function(e){var n;t.properties.src.value=e,t.properties.src.type="url",null===(n=t.gui)||void 0===n||n.updateDisplay(),t.loadMaterial()}))}},{key:"generateGUI",value:function(e){var t=this,n=e.addFolder("material");return n.add(this.properties.src,"value",""),n.add(this.properties.src,"type",["url","id"]),n.add(this,"loadMaterial"),function(){return w.apply(this,arguments)}().then((function(e){n.add(t,"materialName",e)})),this.gui=n,n}},{key:"loadMaterial",value:function(){this.setMaterial(this.properties.src.value,this.properties.src.type)}},{key:"setMaterial",value:(r=Object(h.a)(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.randomizeID(),this.properties.src.value=t,this.properties.src.type=n,e.next=5,this.initMaterial();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"initMaterial",value:(n=Object(h.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("url"!=this.properties.src.type){e.next=6;break}return e.next=3,l.NodeMaterial.ParseFromFileAsync("material",this.properties.src.value,this.scene);case 3:case 9:this.material=e.sent,e.next=13;break;case 6:if("id"!=this.properties.src.type){e.next=12;break}return e.next=9,l.NodeMaterial.ParseFromSnippetAsync(this.properties.src.value,this.scene);case 12:throw"wrong material type";case 13:return e.abrupt("return",this.material);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"randomizeID",value:function(){this.id=Math.random()}},{key:"getMaterial",value:function(){return this.material}},{key:"updateMeshMaterial",value:function(e,t){return t!=this.id&&this.material&&(e.material=this.material),this.id}},{key:"updateNodes",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;j(this.material,r.name,r.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"getJson",value:function(){return this.properties}},{key:"dispose",value:function(){var e;null===(e=this.material)||void 0===e||e.dispose()}}],[{key:"fromJson",value:(t=Object(h.a)(regeneratorRuntime.mark((function t(data,n){var r,o,c,l,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=data,(o=new e(n)).properties=r,c=o.properties.src,l=c.type,h=c.value,t.next=6,o.setMaterial(h,l);case 6:return t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"makeEmpty",value:function(t){return new e(t)}}]),e}(),M=(n(177),n(236),n(49),n(48),n(70),n(71),n(265)),I=n(32),A=n(234),U=n(233),S=n(232),P=n(231);function D(object,e){for(;!Object.prototype.hasOwnProperty.call(object,e)&&null!==(object=Object(P.a)(object)););return object}function F(){return F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var base=D(e,t);if(base){var desc=Object.getOwnPropertyDescriptor(base,t);return desc.get?desc.get.call(arguments.length<3?e:n):desc.value}},F.apply(this,arguments)}n(101);var N="\nuniform sampler2D texture0; // position\nuniform sampler2D texture1; // elevation (/,/,prev,tot)\nuniform sampler2D texture2; // mask (/,/,prev,tot)\nvarying vec2 vTextureCoord;\n\n#define position_texture texture0\n#define elevation_texture texture1\n#define mask_texture texture2\n";function G(e){return{fragmentSource:e,vertexSource:"\n    attribute vec3 position;\n    attribute vec2 textureCoord;\n\n    varying highp vec2 vTextureCoord;\n\n    void main() {\n        gl_Position = vec4(position, 1.0);\n        vTextureCoord = textureCoord;\n    }\n    ",uniforms:[]}}var L="\nvec4 permute(vec4 i) {\n  vec4 im = mod(i, 289.0);\n  return mod(((im*34.0)+10.0)*im, 289.0);\n}\n\n// https://github.com/stegu/psrdnoise/\nfloat psrdnoise(vec3 x, vec3 period, float alpha, out vec3 gradient) {\n  const mat3 M = mat3(0.0, 1.0, 1.0, 1.0, 0.0, 1.0,  1.0, 1.0, 0.0);\n  const mat3 Mi = mat3(-0.5, 0.5, 0.5, 0.5,-0.5, 0.5, 0.5, 0.5,-0.5);\n  vec3 uvw = M * x;\n  vec3 i0 = floor(uvw), f0 = fract(uvw);\n  vec3 g_ = step(f0.xyx, f0.yzz), l_ = 1.0 - g_;\n  vec3 g = vec3(l_.z, g_.xy), l = vec3(l_.xy, g_.z);\n  vec3 o1 = min( g, l ), o2 = max( g, l );\n  vec3 i1 = i0 + o1, i2 = i0 + o2, i3 = i0 + vec3(1.0);\n  vec3 v0 = Mi * i0, v1 = Mi * i1, v2 = Mi * i2, v3 = Mi * i3;\n  vec3 x0 = x - v0, x1 = x - v1, x2 = x - v2, x3 = x - v3;\n  if(any(greaterThan(period, vec3(0.0)))) {\n    vec4 vx = vec4(v0.x, v1.x, v2.x, v3.x);\n    vec4 vy = vec4(v0.y, v1.y, v2.y, v3.y);\n    vec4 vz = vec4(v0.z, v1.z, v2.z, v3.z);\n    if(period.x > 0.0) vx = mod(vx, period.x);\n    if(period.y > 0.0) vy = mod(vy, period.y);\n    if(period.z > 0.0) vz = mod(vz, period.z);\n    i0 = floor(M * vec3(vx.x, vy.x, vz.x) + 0.5);\n    i1 = floor(M * vec3(vx.y, vy.y, vz.y) + 0.5);\n    i2 = floor(M * vec3(vx.z, vy.z, vz.z) + 0.5);\n    i3 = floor(M * vec3(vx.w, vy.w, vz.w) + 0.5);\n  }\n  vec4 hash = permute( permute( permute( \n              vec4(i0.z, i1.z, i2.z, i3.z ))\n            + vec4(i0.y, i1.y, i2.y, i3.y ))\n            + vec4(i0.x, i1.x, i2.x, i3.x ));\n  vec4 theta = hash * 3.883222077;\n  vec4 sz = hash * -0.006920415 + 0.996539792;\n  vec4 psi = hash * 0.108705628;\n  vec4 Ct = cos(theta), St = sin(theta);\n  vec4 sz_prime = sqrt( 1.0 - sz*sz );\n  vec4 gx, gy, gz;\n  if(alpha != 0.0) {\n    vec4 px = Ct * sz_prime, py = St * sz_prime, pz = sz;\n    vec4 Sp = sin(psi), Cp = cos(psi), Ctp = St*Sp - Ct*Cp;\n    vec4 qx = mix( Ctp*St, Sp, sz), qy = mix(-Ctp*Ct, Cp, sz);\n    vec4 qz = -(py*Cp + px*Sp);\n    vec4 Sa = vec4(sin(alpha)), Ca = vec4(cos(alpha));\n    gx = Ca*px + Sa*qx; gy = Ca*py + Sa*qy; gz = Ca*pz + Sa*qz;\n  } else {\n    gx = Ct * sz_prime; gy = St * sz_prime; gz = sz;  \n  }\n  vec3 g0 = vec3(gx.x, gy.x, gz.x), g1 = vec3(gx.y, gy.y, gz.y);\n  vec3 g2 = vec3(gx.z, gy.z, gz.z), g3 = vec3(gx.w, gy.w, gz.w);\n  vec4 w = 0.5-vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3));\n  w = max(w, 0.0); vec4 w2 = w * w, w3 = w2 * w;\n  vec4 gdotx = vec4(dot(g0,x0), dot(g1,x1), dot(g2,x2), dot(g3,x3));\n  float n = dot(w3, gdotx);\n  vec4 dw = -6.0 * w2 * gdotx;\n  vec3 dn0 = w3.x * g0 + dw.x * x0;\n  vec3 dn1 = w3.y * g1 + dw.y * x1;\n  vec3 dn2 = w3.z * g2 + dw.z * x2;\n  vec3 dn3 = w3.w * g3 + dw.w * x3;\n  gradient = 39.5 * (dn0 + dn1 + dn2 + dn3);\n  return 39.5 * n;\n}\n",z=function(){function e(t){var n=t.gl,r=t.height,c=t.width;Object(o.a)(this,e),this.framebuffer=null,this.program=null,this.ready=!1,this.height=r,this.width=c,this.attribs={},this.uniforms={},this.textures=[],this.standardGeometryVals=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]),this.standardVertex="\n            attribute vec3 position;\n            attribute vec2 textureCoord;\n            varying highp vec2 vTextureCoord;\n            void main() {\n                gl_Position = vec4(position, 1.0);\n                vTextureCoord = textureCoord;\n            }\n        ",n?(this.gl=n,this.height=n.drawingBufferHeight,this.width=n.drawingBufferWidth):this.gl=e.createWebglContext(c,r);var l=this.gl.getExtension("OES_texture_float");this.gl.getExtension("WEBGL_color_buffer_float"),l||alert("Floating point textures not supported")}return Object(c.a)(e,[{key:"makeTexture",value:function(data){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.width,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.height,n=this.textures.length;this.textures[n]={tex:this.gl.createTexture(),width:e,height:t},this.gl.activeTexture(this.gl["TEXTURE".concat(n)]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[n].tex),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.FLOAT,data)}},{key:"updateTexture",value:function(data){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=this.textures[e];this.gl.bindTexture(this.gl.TEXTURE_2D,t.tex),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t.width,t.height,0,this.gl.RGBA,this.gl.FLOAT,data)}},{key:"makeFrameBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.width,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.height,n=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.FLOAT,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.framebuffer=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,n,0);var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!=this.gl.FRAMEBUFFER_COMPLETE)switch(r){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"FRAMEBUFFER_UNSUPPORTED";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";default:throw"Framebuffer error: ".concat(r)}}},{key:"buildProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.standardVertex;this.program=this.gl.createProgram();var n=this.compileShader(t,this.gl.VERTEX_SHADER),r=this.compileShader(e,this.gl.FRAGMENT_SHADER);this.gl.attachShader(this.program,n),this.gl.attachShader(this.program,r),this.gl.linkProgram(this.program),this.gl.deleteShader(r),this.gl.deleteShader(n),this.gl.useProgram(this.program);var o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.standardGeometryVals,this.gl.STATIC_DRAW)}},{key:"compileShader",value:function(source,e){var t=this.gl.createShader(e);if(this.gl.shaderSource(t,source),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS))throw"".concat(e," compilation failed: ").concat(this.gl.getShaderInfoLog(t));return t}},{key:"addAttrib",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.numElements,r=void 0===n?3:n,o=t.stride,c=void 0===o?20:o,l=t.offset,h=void 0===l?0:l;this.gl.useProgram(this.program),this.attribs[e]=this.gl.getAttribLocation(this.program,e),this.gl.enableVertexAttribArray(this.attribs[e]),this.gl.vertexAttribPointer(this.attribs[e],r,this.gl.FLOAT,!1,c,h)}},{key:"addUniform",value:function(e){var t=e.name,n=e.type,r=e.value;this.uniforms[t]=this.gl.getUniformLocation(this.program,t),null!=r&&this.gl[n](this.uniforms[t],r)}},{key:"draw",value:function(){if(!this.ready){this.ready=!0;for(var i=0;i<this.textures.length;i++)this.gl.activeTexture(this.gl["TEXTURE".concat(i)]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[i].tex),this.addUniform({name:"texture".concat(i),value:i,type:"uniform1i"})}this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}},{key:"getPixels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height-t,o=new Float32Array(n*r*4);return this.gl.readPixels(e,t,n,r,this.gl.RGBA,this.gl.FLOAT,o),o}},{key:"delete",value:function(){var e;this.gl.deleteProgram(this.program),this.gl.deleteFramebuffer(this.framebuffer);for(var t=0;t<this.textures.length;t++)this.gl.deleteTexture(this.textures[t].tex),this.textures.splice(t,1);null===(e=this.gl.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()}}],[{key:"createWebglContext",value:function(e,t){var canvas=document.createElement("canvas");return canvas.width=e,canvas.height=t,canvas.getContext("webgl",{premultipliedAlpha:!1})}}]),e}();function X(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function J(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;Object(o.a)(this,e),this.texture_built=!1,this.initialized=!1,this.layer_index=0,this._properties={mask_index:-1,mask_only:!1},this._noiseType="default",this.positionShader=this.getPositionShader(),this.controller=n,this.layer_index=r,this.gpuSpecs=t,t&&this.initGPU(t)}return Object(c.a)(e,[{key:"properties",get:function(){return this._properties},set:function(e){this._properties=e}},{key:"noiseType",get:function(){return this._noiseType},set:function(e){this._noiseType=e,this.controller.changeNoiseType(e)}},{key:"setIndex",value:function(e){this.layer_index=e}},{key:"getMaskIndex",value:function(){return this.properties.mask_index}},{key:"getPositionShader",value:function(){return{vertexSource:"\n      attribute vec3 position;\n      attribute vec2 textureCoord;\n\n      varying highp vec2 vTextureCoord;\n\n      void main() {\n          // NON TOCCARE\n          gl_Position = vec4(position, 1.0);\n          vTextureCoord = textureCoord;\n          // ===========\n      }\n    ",fragmentSource:"\n      precision highp float;\n\n      \n      ".concat(N,"\n\n      void main() {\n        gl_FragColor = texture2D(elevation_texture, vTextureCoord);\n        // gl_FragColor = vec4(vTextureCoord, 0.3, 0.3);\n        // gl_FragColor = vec4(-2.0, 2.0, -2.0, 2.0);\n      }\n    "),uniforms:[]}}},{key:"isInitialized",value:function(){return this.initialized}},{key:"init",value:function(){}},{key:"dispose",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null===(e=this.gpu)||void 0===e||e.delete(),t&&k(this.gui)}},{key:"getJson",value:function(){return function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?J(Object(source),!0).forEach((function(t){Object(I.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):J(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({noise_type:this.noiseType},this.properties)}},{key:"generateGui",value:function(e){return e.add(this,"noiseType",be),this.observeGUI(e.add(this.properties,"mask_index",-1,this.layer_index-1,1)),this.observeGUI(e.add(this.properties,"mask_only")),this.gui=e,e}},{key:"observeGUI",value:function(e,t){var n=this;e.onChange((function(e){n.controller.changedLayer=Math.min(n.controller.changedLayer,n.layer_index),t&&t()}))}},{key:"initGPU",value:function(e){var t=e.gl,n=e.height,r=e.width;this.gpu&&this.gpu.delete();var o=new z({gl:t,height:n,width:r});o.makeFrameBuffer(r,n),o.buildProgram(this.positionShader.fragmentSource,this.positionShader.vertexSource),o.addAttrib("position",{numElements:3,stride:20,offset:0}),o.addAttrib("textureCoord",{numElements:2,stride:20,offset:12}),this.gpu=o,this.initialized=!0,this.gpuSpecs={gl:t,height:n,width:r}}},{key:"updateTextures",value:function(e,t,n){if(!this.gpu)throw"initialize gpu first";this.texture_built?(this.gpu.updateTexture(t,0),this.gpu.updateTexture(e,1),n&&this.gpu.updateTexture(n,2)):(this.gpu.makeTexture(t),this.gpu.makeTexture(e),this.gpu.makeTexture(n||new Float32Array(0)),this.texture_built=!0)}},{key:"applyNoise",value:function(e,t,n){if(!this.gpu)throw"initialize gpu first";this.updateTextures(e,t,n);var r,o=X(this.getUniforms());try{for(o.s();!(r=o.n()).done;){var c=r.value;this.gpu.addUniform(c)}}catch(e){o.e(e)}finally{o.f()}return this.gpu.draw(),this.gpu.getPixels()}},{key:"getUniforms",value:function(){return[{type:"uniform1i",name:"is_masked",value:this.properties.mask_index>=0?1:0},{type:"uniform1i",name:"mask_only",value:this.properties.mask_only?1:0}]}}],[{key:"fromJson",value:function(data,e,t,n){var r=new e(void 0,t,n),o=data;for(var c in o)"noise_type"!=c&&(r.properties[c]=o[c]);return r.init(),r}}]),e}();function H(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function W(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?H(Object(source),!0).forEach((function(t){Object(I.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):H(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var Y=function(e){Object(U.a)(n,e);var t=$(n);function n(){var e,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,l=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(r=t.call(this,c,l,h))._properties=W(W({},F((e=Object(A.a)(r),Object(P.a)(n.prototype)),"properties",e)),{},{amplitude:1,frequency:1,octaves:1,persistance:.5,lacunarity:2,exponent:1,mantain_sign:!1,seed:Math.floor(9999*Math.random())}),r._noiseType="basic",r}return Object(c.a)(n,[{key:"properties",get:function(){return this._properties}},{key:"getPositionShader",value:function(){return G(Z)}},{key:"getUniforms",value:function(){return[].concat(Object(M.a)(F(Object(P.a)(n.prototype),"getUniforms",this).call(this)),[{type:"uniform1f",name:"amplitude",value:this.properties.amplitude},{type:"uniform1f",name:"frequency",value:this.properties.frequency},{type:"uniform1i",name:"octaves",value:this.properties.octaves},{type:"uniform1f",name:"persistance",value:this.properties.persistance},{type:"uniform1f",name:"lacunarity",value:this.properties.lacunarity},{type:"uniform1i",name:"exponent",value:this.properties.exponent},{type:"uniform1i",name:"mantain_sign",value:this.properties.mantain_sign?1:0},{type:"uniform1i",name:"seed",value:this.properties.seed}])}},{key:"generateGui",value:function(e){return e=F(Object(P.a)(n.prototype),"generateGui",this).call(this,e),this.observeGUI(e.add(this.properties,"seed",0,9999,1)),this.observeGUI(e.add(this.properties,"amplitude",-1,1,.01)),this.observeGUI(e.add(this.properties,"frequency",.1,5,.01)),this.observeGUI(e.add(this.properties,"octaves",1,10,1)),this.observeGUI(e.add(this.properties,"persistance",.1,1,.001)),this.observeGUI(e.add(this.properties,"lacunarity",.1,3,.1)),this.observeGUI(e.add(this.properties,"exponent",1,6,1)),this.observeGUI(e.add(this.properties,"mantain_sign")),e}}]),n}(V),Z="\nprecision highp float;\n\nuniform float amplitude;\nuniform float frequency;\nuniform int octaves;\nuniform float persistance;\nuniform float lacunarity;\nuniform int seed;\nuniform int exponent;\nuniform int mantain_sign;\n\nuniform int is_masked;\nuniform int mask_only;\n\n".concat(N,"\n\n").concat(L,"\n\nconst int MAX_OCTAVES  = 32;\nconst int MAX_EXPONENT = 8;\n\nvoid main() {\n  vec4 position = texture2D(position_texture, vTextureCoord);\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n//NOTE: all the elevation values start from 1 instead of 0! subract 1 for masks!\n  float total_elevation = 0.0;\n  float oct_amplitude = amplitude;\n  float oct_frequency = frequency;\n\n  vec3 p = vec3(0.0);\n  vec3 g;\n  float alpha = 1.0 * float(seed);\n\n  for(int i = 0; i < MAX_OCTAVES; i++) {\n    if(i >= octaves) { break; }\n\n    vec3 v = position.xyz * oct_frequency;\n\n    total_elevation += psrdnoise(v, p, alpha, g) * oct_amplitude;\n\n    oct_frequency *= lacunarity;\n    oct_amplitude *= persistance;\n  }\n\n  vec3 pos = position.xyz;\n\n  for(int i = 0; i < MAX_EXPONENT; i++) {\n    if(i >= exponent - 1) { break; }\n\n    total_elevation *= total_elevation;\n  }\n\n  if(mantain_sign == 1) { total_elevation *= sign(amplitude); }\n\n  if(is_masked == 1) {\n    vec4 mask_elevation = texture2D(mask_texture, vTextureCoord);\n    total_elevation *= mask_elevation.b;\n  }\n\n  float output_elevation = prev_elevation.a;\n  if(mask_only == 0) { output_elevation += total_elevation; }\n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    output_elevation\n  );\n}\n");function K(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Q(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?K(Object(source),!0).forEach((function(t){Object(I.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):K(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var te=function(e){Object(U.a)(n,e);var t=ee(n);function n(){var e,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,l=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(r=t.call(this,c,l,h))._properties=Q(Q({},F((e=Object(A.a)(r),Object(P.a)(n.prototype)),"properties",e)),{},{seed:Math.floor(9999*Math.random()),crater_amount:3,crater_min:0,crater_max:ne.length-1,size_distribution:.2}),r.crater_positions=[],r.crater_sizes=[],r.crater_rims=[],r._noiseType="crater",r}return Object(c.a)(n,[{key:"properties",get:function(){return this._properties}},{key:"init",value:function(){F(Object(P.a)(n.prototype),"init",this).call(this),this.generateCraters()}},{key:"getPositionShader",value:function(){return G(re)}},{key:"generateGui",value:function(e){return e=F(Object(P.a)(n.prototype),"generateGui",this).call(this,e),this.observeGUI(e.add(this.properties,"crater_amount",0,64,1)),this.observeGUI(e.add(this.properties,"seed",0,9999,1)),this.observeGUI(e.add(this.properties,"crater_min",0,ne.length-1,1)),this.observeGUI(e.add(this.properties,"crater_max",0,ne.length-1,1)),this.observeGUI(e.add(this.properties,"size_distribution",0,1,.01)),e}},{key:"generateCraters",value:function(){for(var i=0;i<this.properties.crater_amount;i++){n.randomSpherePoint(this.controller.getRadius()).toArray(this.crater_positions,3*i);var e=Math.floor(n.biasFunction(Math.random(),this.properties.size_distribution)*ne.length);e=Math.max(e,this.properties.crater_min),e=Math.min(e,this.properties.crater_max),this.crater_sizes[3*i+0]=n.bellFunction(ne[e].crater_floor,ne[e].variation),this.crater_sizes[3*i+1]=n.bellFunction(ne[e].crater_height,ne[e].variation),this.crater_sizes[3*i+2]=n.bellFunction(ne[e].crater_width,ne[e].variation),this.crater_rims[3*i+0]=n.bellFunction(ne[e].rim_offset,ne[e].variation),this.crater_rims[3*i+1]=n.bellFunction(ne[e].rim_steepness,ne[e].variation),this.crater_rims[3*i+2]=n.bellFunction(ne[e].smoothness,ne[e].variation)}}},{key:"applyNoise",value:function(e,t,r){return this.generateCraters(),F(Object(P.a)(n.prototype),"applyNoise",this).call(this,e,t,r)}},{key:"getUniforms",value:function(){return[].concat(Object(M.a)(F(Object(P.a)(n.prototype),"getUniforms",this).call(this)),[{type:"uniform1fv",name:"crater_positions",value:this.crater_positions},{type:"uniform1fv",name:"crater_sizes",value:this.crater_sizes},{type:"uniform1fv",name:"crater_rims",value:this.crater_rims},{type:"uniform1i",name:"crater_amount",value:this.properties.crater_amount}])}}],[{key:"randomSpherePoint",value:function(e){var u=Math.random(),t=Math.random(),n=2*u*Math.PI,r=Math.acos(2*t-1),o=Math.sin(n),c=Math.cos(n),h=Math.sin(r),f=e*h*c,v=e*h*o,d=e*Math.cos(r);return new l.Vector3(f,v,d)}},{key:"biasFunction",value:function(e,t){if(e>1||e<0)throw new Error("x must be between 0 and 1");var n=Math.pow(1-t,3);return e*n/(e*n-e+1)}},{key:"bellFunction",value:function(base,e){var t=base-base*e;return t+(base+base*e-t)*(1-Math.pow(2*Math.random()-1,4))}}]),n}(V),ne=[{variation:.1,crater_width:.05,crater_height:.13,crater_floor:-.03,rim_steepness:.508,rim_offset:.54,smoothness:.178},{variation:.1,crater_width:.11,crater_height:.13,crater_floor:-.05,rim_steepness:.364,rim_offset:.52,smoothness:.112},{variation:.1,crater_width:.2,crater_height:.08,rim_steepness:.259,rim_offset:.47,crater_floor:-.02,smoothness:.035},{variation:.1,crater_width:.25,crater_height:.13,rim_steepness:.303,rim_offset:.58,crater_floor:-.02,smoothness:0},{variation:.1,crater_width:.38,crater_height:.476,rim_steepness:.5,rim_offset:.46,crater_floor:-.07,smoothness:.112}],re="\nprecision highp float;\nconst int MAX_CRATERS = 64;\n\nuniform int is_masked;\nuniform int mask_only;\n\nuniform float crater_rims[MAX_CRATERS * 3];\nuniform float crater_positions[MAX_CRATERS * 3];\nuniform float crater_sizes[MAX_CRATERS * 3];\n\nuniform int crater_amount;\n\n\n".concat(N,"\n\n").concat(L,"\n\nfloat smoothMin(float a, float b, float k) {\n  float h = clamp((b - a + k) / (2.0 * k), 0.0, 1.0);\n  return a * h + b * (1.0 - h) - k * h * (1.0 - h);\n}\n\nfloat smoothMax(float a, float b, float k) {\n  float mk = -k;\n  float h = clamp((b - a + mk) / (2.0 * mk), 0.0, 1.0);\n  return a * h + b * (1.0 - h) - mk * h * (1.0 - h);\n}\n\nvoid main() {\n  vec3 position = texture2D(position_texture, vTextureCoord).xyz;\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n  float total_elevation = 0.0;\n\n  for(int i = 0; i < MAX_CRATERS; i++) {\n    if(i >= crater_amount) break;\n\n    float crater_floor = crater_sizes[i*3+0];\n    float crater_height = crater_sizes[i*3+1];\n    float crater_width = crater_sizes[i*3+2];\n\n    float rim_offset = crater_rims[i*3+0];\n    float rim_steepness = crater_rims[i*3+1];\n    float smoothness = crater_rims[i*3+2];\n\n    vec3 center = vec3(\n      crater_positions[i * 3 + 0],\n      crater_positions[i * 3 + 1],\n      crater_positions[i * 3 + 2]\n    );\n\n    float x = length(position - center) / crater_width; \n\n    float cavity = (x * x - 1.0) * crater_height;\n    float rimX = min(x - 1.0 - rim_offset, 0.0);\n    float rim = rim_steepness * rimX * rimX;\n\n    float crater_shape = smoothMax(cavity, crater_floor, smoothness / 2.0); \n    crater_shape = smoothMin(crater_shape, rim, smoothness);\n\n    total_elevation += crater_shape;\n\n    if(total_elevation > rim) {\n      total_elevation -= crater_shape + crater_shape / 10.0;\n    }\n  }\n  \n  float output_elevation = prev_elevation.a;\n  if(mask_only == 0) { output_elevation += total_elevation; }\n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    output_elevation\n  );\n}\n");function ie(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function ae(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ie(Object(source),!0).forEach((function(t){Object(I.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ie(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var se=function(e){Object(U.a)(n,e);var t=oe(n);function n(){var e,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,l=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(r=t.call(this,c,l,h))._properties=ae(ae({},F((e=Object(A.a)(r),Object(P.a)(n.prototype)),"properties",e)),{},{vertical_shift:0,floor:0,ceiling:1}),r._noiseType="mask",r}return Object(c.a)(n,[{key:"properties",get:function(){return this._properties}},{key:"getPositionShader",value:function(){return G(ce)}},{key:"getUniforms",value:function(){return[].concat(Object(M.a)(F(Object(P.a)(n.prototype),"getUniforms",this).call(this)),[{type:"uniform1f",name:"vertical_shift",value:this.properties.vertical_shift},{type:"uniform1f",name:"ffloor",value:this.properties.floor},{type:"uniform1f",name:"ceiling",value:this.properties.ceiling}])}},{key:"generateGui",value:function(e){return e=F(Object(P.a)(n.prototype),"generateGui",this).call(this,e),this.observeGUI(e.add(this.properties,"vertical_shift",-2,2,.01)),this.observeGUI(e.add(this.properties,"floor",-2,2,.1)),this.observeGUI(e.add(this.properties,"ceiling",-2,2,.1)),e}}]),n}(Y),ce="\nprecision highp float;\n\nuniform float amplitude;\nuniform float frequency;\nuniform int octaves;\nuniform float persistance;\nuniform float lacunarity;\nuniform int seed;\nuniform int exponent;\n\nuniform float ffloor;\nuniform float ceiling;\nuniform float vertical_shift;\n\nuniform int is_masked;\nuniform int mask_only;\n\n".concat(N,"\n\n").concat(L,"\n\nconst int MAX_OCTAVES = 32;\nconst int MAX_EXPONENT = 8;\n\nvoid main() {\n  vec4 position = texture2D(position_texture, vTextureCoord);\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n//NOTE: all the elevation values start from 1 instead of 0! subract 1 for masks!\n  float total_elevation = 0.0;\n  float oct_amplitude = amplitude * 2.0;\n  float oct_frequency = frequency;\n\n  vec3 p = vec3(0.0);\n  vec3 g;\n  float alpha = 1.0 * float(seed);\n\n  for(int i = 0; i < MAX_OCTAVES; i++) {\n    if(i >= octaves) { break; }\n\n    vec3 v = position.xyz * oct_frequency;\n\n    total_elevation += (0.5 + 0.5 * psrdnoise(v, p, alpha, g)) * oct_amplitude;\n\n    oct_frequency *= lacunarity;\n    oct_amplitude *= persistance;\n  }\n\n  vec3 pos = position.xyz;\n\n  for(int i = 0; i < MAX_EXPONENT; i++) {\n    if(i >= exponent - 1) { break; }\n\n    total_elevation *= total_elevation;\n  }\n\n  if(is_masked == 1) {\n    vec4 mask_elevation = texture2D(mask_texture, vTextureCoord);\n    total_elevation *= mask_elevation.b;\n  }\n\n  total_elevation += vertical_shift;\n\n  total_elevation = min(total_elevation, ceiling);\n  total_elevation = max(ffloor, total_elevation);\n\n  float output_elevation = prev_elevation.a;\n  if(mask_only == 0) { output_elevation += total_elevation; }\n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    output_elevation\n  );\n}\n");function ue(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function le(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ue(Object(source),!0).forEach((function(t){Object(I.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):ue(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var fe=function(e){Object(U.a)(n,e);var t=he(n);function n(){var e,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,l=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(r=t.call(this,c,l,h))._properties=le(le({},F((e=Object(A.a)(r),Object(P.a)(n.prototype)),"properties",e)),{},{ocean_floor:0,ocean_depth:1,ocean_level:1,floor_flatten:5}),r._noiseType="ocean_modifier",r}return Object(c.a)(n,[{key:"properties",get:function(){return this._properties}},{key:"getPositionShader",value:function(){return G(pe)}},{key:"getUniforms",value:function(){return[].concat(Object(M.a)(F(Object(P.a)(n.prototype),"getUniforms",this).call(this)),[{type:"uniform1f",name:"ocean_floor",value:this.properties.ocean_floor},{type:"uniform1f",name:"ocean_depth",value:this.properties.ocean_depth},{type:"uniform1f",name:"ocean_level",value:this.properties.ocean_level},{type:"uniform1f",name:"floor_flatten",value:this.properties.floor_flatten}])}},{key:"generateGui",value:function(e){return e=F(Object(P.a)(n.prototype),"generateGui",this).call(this,e),this.observeGUI(e.add(this.properties,"ocean_floor",-2,2,.01)),this.observeGUI(e.add(this.properties,"ocean_depth",.1,5,.01)),this.observeGUI(e.add(this.properties,"ocean_level",-2,2,.01)),this.observeGUI(e.add(this.properties,"floor_flatten",1,10,.1)),e}}]),n}(V),pe="\nprecision highp float;\n\nuniform float ocean_floor;\nuniform float ocean_depth;\nuniform float ocean_level;\nuniform float floor_flatten;\n\nuniform int is_masked;\n\n".concat(N,"\n\n").concat(L,"\n\nconst int MAX_OCTAVES  = 32;\nconst int MAX_EXPONENT = 8;\n\nvoid main() {\n  vec4 position = texture2D(position_texture, vTextureCoord);\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n  float total_elevation = prev_elevation.a;\n\n  if(total_elevation <= ocean_level) {\n    float depth = ocean_level - total_elevation;\n\n    total_elevation += depth;\n\n    depth *= ocean_depth;\n    \n    total_elevation -= depth;\n  }\n\n  if(total_elevation < ocean_floor) {\n    float extra_depth = ocean_floor - total_elevation;\n\n    total_elevation += extra_depth;\n    \n    extra_depth /= floor_flatten;\n\n    total_elevation -= extra_depth;\n  }\n  \n  if(is_masked == 1) {\n    vec4 mask_elevation = texture2D(mask_texture, vTextureCoord);\n    total_elevation *= mask_elevation.b;\n  } \n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    total_elevation\n  );\n}\n");function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var de=function(e){Object(U.a)(n,e);var t=ve(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,c=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(e=t.call(this,r,c,l))._noiseType="positive",e}return Object(c.a)(n,[{key:"getPositionShader",value:function(){return G(me)}}]),n}(Y),me="\nprecision highp float;\n\nuniform float amplitude;\nuniform float frequency;\nuniform int octaves;\nuniform float persistance;\nuniform float lacunarity;\nuniform int seed;\nuniform int exponent;\n\nuniform int is_masked;\nuniform int mask_only;\n\n".concat(N,"\n\n").concat(L,"\n\nconst int MAX_OCTAVES = 32;\nconst int MAX_EXPONENT = 8;\n\nvoid main() {\n  vec4 position = texture2D(position_texture, vTextureCoord);\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n//NOTE: all the elevation values start from 1 instead of 0! subract 1 for masks!\n  float total_elevation = 0.0;\n  float oct_amplitude = amplitude;\n  float oct_frequency = frequency;\n\n  vec3 p = vec3(0.0);\n  vec3 g;\n  float alpha = 1.0 * float(seed);\n\n  for(int i = 0; i < MAX_OCTAVES; i++) {\n    if(i >= octaves) { break; }\n\n    vec3 v = position.xyz * oct_frequency;\n\n    total_elevation += (0.5 + 0.5 * psrdnoise(v, p, alpha, g)) * oct_amplitude;\n\n    oct_frequency *= lacunarity;\n    oct_amplitude *= persistance;\n  }\n\n  vec3 pos = position.xyz;\n\n  for(int i = 0; i < MAX_EXPONENT; i++) {\n    if(i >= exponent - 1) { break; }\n\n    total_elevation *= total_elevation;\n  }\n\n  if(is_masked == 1) {\n    vec4 mask_elevation = texture2D(mask_texture, vTextureCoord);\n    total_elevation *= mask_elevation.b;\n  }\n\n  float output_elevation = prev_elevation.a;\n  if(mask_only == 0) { output_elevation += total_elevation; }\n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    output_elevation\n  );\n}\n");function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(P.a)(e);if(t){var o=Object(P.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(S.a)(this,n)}}var ye=function(e){Object(U.a)(n,e);var t=ge(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,c=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return Object(o.a)(this,n),(e=t.call(this,r,c,l))._noiseType="ridge",e}return Object(c.a)(n,[{key:"getPositionShader",value:function(){return G(_e)}}]),n}(Y),_e="\nprecision highp float;\n\nuniform float amplitude;\nuniform float frequency;\nuniform int octaves;\nuniform float persistance;\nuniform float lacunarity;\nuniform int seed;\nuniform int exponent;\nuniform int mantain_sign;\n\nuniform int is_masked;\nuniform int mask_only;\n\n".concat(N,"\n\n").concat(L,"\n\nconst int MAX_OCTAVES  = 32;\nconst int MAX_EXPONENT = 8;\n\nvoid main() {\n  vec4 position = texture2D(position_texture, vTextureCoord);\n  vec4 prev_elevation = texture2D(elevation_texture, vTextureCoord);\n\n//NOTE: all the elevation values start from 1 instead of 0! subract 1 for masks!\n  float total_elevation = 0.0;\n  float oct_amplitude = amplitude;\n  float oct_frequency = frequency;\n  float elevation_mask = 1.0;\n\n  vec3 p = vec3(0.0);\n  vec3 g;\n  float alpha = 1.0 * float(seed);\n\n  for(int i = 0; i < MAX_OCTAVES; i++) {\n    if(i >= octaves) { break; }\n\n    vec3 v = position.xyz * oct_frequency;\n\n    float layer = (1.0 - abs(psrdnoise(v, p, alpha, g)));\n\n    layer *= elevation_mask;\n    elevation_mask = layer;\n\n    total_elevation += layer * oct_amplitude;\n\n    oct_frequency *= lacunarity;\n    oct_amplitude *= persistance;\n  }\n\n  vec3 pos = position.xyz;\n\n  for(int i = 0; i < MAX_EXPONENT; i++) {\n    if(i >= exponent - 1) { break; }\n\n    total_elevation *= total_elevation;\n  }\n\n  if(mantain_sign == 1) {\n    total_elevation = abs(total_elevation) * sign(amplitude);\n  }\n  \n  if(is_masked == 1) {\n    vec4 mask_elevation = texture2D(mask_texture, vTextureCoord);\n    total_elevation *= mask_elevation.b;\n  } \n\n  float output_elevation = prev_elevation.a;\n  if(mask_only == 0) { output_elevation += total_elevation; }\n\n  gl_FragColor = vec4(\n    0.0, 0.0,\n    total_elevation,\n    output_elevation\n  );\n}\n"),be=["default","basic","positive","ridge","ocean_modifier","mask","crater"],xe=function(){function e(t){Object(o.a)(this,e),this.noiseLayers=[],this.elevationDataCache=[],this.changedLayer=0,this._currentLayer=0,this.data_controller=t}return Object(c.a)(e,[{key:"currentLayer",get:function(){return this._currentLayer},set:function(e){this._currentLayer!=e&&(this._currentLayer=e,this.switchLayer())}},{key:"getRadius",value:function(){return this.data_controller.getRadius()}},{key:"dispose",value:function(){this.noiseLayers.forEach((function(e){e.dispose()})),k(this.mainGUI)}},{key:"getJson",value:function(){return{layer_amount:this.noiseLayers.length,layers:this.noiseLayers.map((function(e){return e.getJson()}))}}},{key:"addLayer",value:function(e){var t,n=e||new V(this.gpuSpecs,this,this.noiseLayers.length);this.noiseLayers.push(n),null===(t=this.indexGUI)||void 0===t||t.max(this.noiseLayers.length-1),this.updateIndexes(),this.switchLayer(this.noiseLayers.length-1)}},{key:"removeLayer",value:function(){var e,t;0==this.noiseLayers.length||this.currentLayer>=this.noiseLayers.length||(this.noiseLayers[this.currentLayer].dispose(!1),this.noiseLayers.splice(this.currentLayer,1),this.currentLayer>=this.noiseLayers.length&&(this.currentLayer=Math.max(0,this.noiseLayers.length-1)),0==this.noiseLayers.length&&this.clearNoiseGUI(),null===(e=this.indexGUI)||void 0===e||e.max(Math.max(0,this.noiseLayers.length-1)),null===(t=this.indexGUI)||void 0===t||t.setValue(this.currentLayer),this.elevationDataCache=this.elevationDataCache.splice(0,this.currentLayer),this.updateIndexes(),this.switchLayer())}},{key:"switchLayer",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentLayer;this.layerGUI&&0!=this.noiseLayers.length&&(this.currentLayer=t,this.clearNoiseGUI(),this.noiseLayers[t].generateGui(this.layerGUI),null===(e=this.indexGUI)||void 0===e||e.setValue(t))}},{key:"updateIndexes",value:function(){this.noiseLayers.forEach((function(e,t){return e.setIndex(t)}))}},{key:"clearNoiseGUI",value:function(){this.mainGUI&&this.layerGUI&&(this.mainGUI.removeFolder(this.layerGUI),this.layerGUI=this.mainGUI.addFolder("noise layer"))}},{key:"changeNoiseType",value:function(e){if(this.mainGUI&&this.layerGUI){var t=new(0,Oe[e])(this.gpuSpecs,this,this.currentLayer);this.noiseLayers[this.currentLayer].dispose(!1),this.noiseLayers[this.currentLayer]=t,this.clearNoiseGUI(),t.generateGui(this.layerGUI)}}},{key:"generateGUI",value:function(){this.mainGUI=new f.a;var e=this.mainGUI.addFolder("noise controller");e.add(this,"addLayer"),e.add(this,"removeLayer"),this.indexGUI=e.add(this,"currentLayer",0,Math.max(0,this.noiseLayers.length-1),1),this.layerGUI=this.mainGUI.addFolder("noise layer"),this.switchLayer()}},{key:"destroyGUI",value:function(){k(this.mainGUI)}},{key:"initializeLayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.gpuSpecs;if(!e)throw"bad gpu specs";this.noiseLayers.forEach((function(t){t.isInitialized()||t.initGPU(e)}))}},{key:"setGPUSpecs",value:function(e){this.gpuSpecs=e,this.initializeLayers(this.gpuSpecs)}},{key:"applyLayers",value:function(e,t){var n=this;if(!this.gpuSpecs)throw"gpu specs not initialized";if(this.initializeLayers(),e&&(this.baseElevationDataCache=e),t&&(this.positionDataCache=t),!this.baseElevationDataCache||!this.positionDataCache)throw"elevation and position data are not initialized nor passed!";for(var r=function(i){var e=n.noiseLayers[i],t=void 0;e.getMaskIndex()>=0&&e.getMaskIndex()<i&&(t=n.elevationDataCache[e.getMaskIndex()]);var r=0==i?n.baseElevationDataCache:n.elevationDataCache[i-1],o=n.data_controller.getRadius(),c=n.positionDataCache.slice();c=c.map((function(p){return p*o})),n.elevationDataCache[i]=e.applyNoise(r,c,t)},i=this.changedLayer;i<this.noiseLayers.length;i++)r(i);this.changedLayer=this.noiseLayers.length}},{key:"isElevationDataInitialized",value:function(){return this.baseElevationDataCache&&this.positionDataCache}},{key:"getLayerData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.elevationDataCache.length-1;if(0==this.elevationDataCache.length){if(!this.baseElevationDataCache)throw"not base elevation data nor any noise layer was initialized";return this.baseElevationDataCache}return this.elevationDataCache[e]}}],[{key:"fromJson",value:function(data,t){var n=new e(t);return data.layers.forEach((function(e,t){var r=V.fromJson(e,Oe[e.noise_type],n,t);n.addLayer(r)})),n}},{key:"makeEmpty",value:function(t){return new e(t)}}]),e}(),Oe={basic:Y,default:V,mask:se,ocean_modifier:fe,positive:de,ridge:ye,crater:te},ke=function(){function e(){Object(o.a)(this,e),this.properties={type:"terrestrial1",radius:1,scale:1,seed:Math.floor(9999*Math.random()),sea_level:0,min_height:0,max_height:0}}var t;return Object(c.a)(e,[{key:"generateGui",value:function(e){var t=this;return this.gui=e.addFolder("planet data"),this.gui.add(this.properties,"radius",.1,10,.1).onChange((function(){t.noise_controller.changedLayer=0})),this.gui.add(this.properties,"scale",.1,10,.01),this.gui.add(this.properties,"sea_level",0,1,.01),this.material_controller.generateGUI(e),this.noise_controller.generateGUI(),this.gui}},{key:"setNoiseController",value:function(e){this.noise_controller=e}},{key:"setMaterialController",value:function(e){this.material_controller=e}},{key:"setMinHeight",value:function(e){this.properties.min_height=e}},{key:"setMaxHeight",value:function(e){this.properties.max_height=e}},{key:"setMinMaxHeight",value:function(e,t){this.properties.min_height=e,this.properties.max_height=t}},{key:"getMinHeight",value:function(){return this.properties.min_height}},{key:"getMaxHeight",value:function(){return this.properties.max_height}},{key:"getRadius",value:function(){return this.properties.radius}},{key:"getScale",value:function(){return this.properties.scale}},{key:"getNoiseController",value:function(){return this.noise_controller}},{key:"getMaterialController",value:function(){return this.material_controller}},{key:"dispose",value:function(){this.noise_controller.dispose(),this.material_controller.dispose(),k(this.gui)}},{key:"updateMeshMaterial",value:function(e,t){return this.material_controller.updateNodes([{name:"INminHeight",value:this.properties.min_height},{name:"INmaxHeight",value:this.properties.max_height},{name:"INseaLevel",value:this.properties.sea_level}]),this.material_controller.updateMeshMaterial(e,t)}},{key:"getJson",value:function(){var data={properties:this.properties};return data.noise_controller=this.noise_controller.getJson(),data.material_controller=this.material_controller.getJson(),data}}],[{key:"fromJson",value:(t=Object(h.a)(regeneratorRuntime.mark((function t(data,n){var r,o,c,l,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=data,o=new e,c=xe.fromJson(r.noise_controller,o),t.next=5,C.fromJson(r.material_controller,n);case 5:for(h in l=t.sent,o.setNoiseController(c),o.setMaterialController(l),r.properties)o.properties[h]=r.properties[h];return t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"makeEmpty",value:function(t){var n=new e;return n.setNoiseController(xe.makeEmpty(n)),n.setMaterialController(C.makeEmpty(t)),n}}]),e}(),we=function(){function e(t,n){Object(o.a)(this,e),this._schemFile="",this.autoUpdate=!1,this.scene=t,this.dataController=n,this.setMesh(this.generateMesh()),this.initUpdate(),this.generateGUI()}var t,n,r,l,v;return Object(c.a)(e,[{key:"schemFile",get:function(){return this._schemFile},set:function(e){var t=this;this._schemFile=e,_(e).then((function(data){return t.regen(JSON.parse(data))}))}},{key:"getDataController",value:function(){return this.dataController}},{key:"regen",value:(v=Object(h.a)(regeneratorRuntime.mark((function e(data){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dataController.dispose(),k(this.mainGUI),!data){e.next=8;break}return e.next=5,ke.fromJson(data,this.scene);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=ke.makeEmpty(this.scene);case 9:t=e.t0,this.dataController=t,this.setMesh(this.generateMesh()),this.generateGUI(),this.update();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"dispose",value:function(){var e;k(this.mainGUI),this.dataController.dispose(),null===(e=this.mesh)||void 0===e||e.dispose(),this.stopUpdate()}},{key:"initUpdate",value:function(){var e=this;this.updateInterval=setInterval((function(){e.autoUpdate&&e.update()}),16)}},{key:"stopUpdate",value:function(){this.updateInterval&&clearInterval(this.updateInterval),delete this.updateInterval}},{key:"update",value:function(){var e;null===(e=this.mesh)||void 0===e||e.updateMesh()}},{key:"generateMesh",value:function(){return new O(this.scene,void 0,this)}},{key:"setMesh",value:function(e){var t;null===(t=this.mesh)||void 0===t||t.dispose(),this.mesh=e}},{key:"generateGUI",value:function(){k(this.mainGUI),this.mainGUI=new f.a;var e=this.mainGUI.addFolder("functions");e.add(this,"autoUpdate"),e.add(this,"update"),e.add(this,"downloadJson"),e.add(this,"resetPlanet"),this.schematicGUI=e.add(this,"schemFile",[]),this.dataGUI=this.dataController.generateGui(this.mainGUI),this.updateSchematicList()}},{key:"updateSchematicList",value:(l=Object(h.a)(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:n=e.sent,null===(t=this.schematicGUI)||void 0===t||t.options(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"downloadJson",value:function(){var e,text,element;e="planet_data.json",text=JSON.stringify(this.dataController.getJson()),(element=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(text)),element.setAttribute("download",e),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)}},{key:"uploadJson",value:function(){}},{key:"resetPlanet",value:function(){this.regen()}}],[{key:"fromJson",value:(r=Object(h.a)(regeneratorRuntime.mark((function t(n,data){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ke.fromJson(data,n);case 2:return r=t.sent,(o=new e(n,r)).update(),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)}))),function(e,t){return r.apply(this,arguments)})},{key:"fromFirebase",value:(n=Object(h.a)(regeneratorRuntime.mark((function e(t,n){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(n);case 2:return data=e.sent,e.abrupt("return",this.fromJson(t,JSON.parse(data)));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"makeEmpty",value:(t=Object(h.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new e(n,ke.makeEmpty(n)));case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ee=function(){function e(canvas){var t=this;Object(o.a)(this,e),this.planets=[],this.engine=new l.Engine(canvas),this.scene=this.getNewScene(this.engine,canvas),this.divFps=document.getElementById("fps"),this.engine.runRenderLoop((function(){t.scene.render(),t.divFps&&(t.divFps.innerHTML=t.engine.getFps().toFixed()+" fps")})),window.addEventListener("resize",(function(){t.engine.resize()})),we.fromFirebase(this.scene,"terr_2.json").then((function(e){return t.planets[0]=e}))}return Object(c.a)(e,[{key:"setPlanetFromJson",value:function(data){var e=this;this.planets[0].dispose(),we.fromJson(this.scene,data).then((function(t){e.planets[0]=t}))}},{key:"getNewScene",value:function(e,canvas){var t=new l.Scene(e),n=new l.ArcRotateCamera("Camera",Math.PI/4,Math.PI/4,16,l.Vector3.Zero(),t);n.wheelDeltaPercentage=.01,n.minZ=0,n.setTarget(l.Vector3.Zero()),n.attachControl(canvas,!1),new l.HemisphericLight("light1",new l.Vector3(0,1,0),t);new l.PointLight("light2",new l.Vector3(0,2,0),t);return t.clearColor=new l.Color4(19/255,19/255,26/255),t}},{key:"dispose",value:function(){this.planets.forEach((function(e){return e.dispose()}))}}]),e}(),je=r.a.extend({name:"IndexPage",data:function(){var data={universe:void 0,schematics:void 0};return data},computed:{},mounted:function(){Object(d.b)();var canvas=document.getElementById("canvas");this.universe=new Ee(canvas)},methods:{upload:function(e){var t=this,n=new FileReader;n.readAsText(e.target.files[0]),n.onload=function(){var e;"string"==typeof n.result&&(null===(e=t.universe)||void 0===e||e.setPlanetFromJson(JSON.parse(n.result)))}}},destroyed:function(){var e;null===(e=this.universe)||void 0===e||e.dispose()}}),Te=(n(363),n(41)),component=Object(Te.a)(je,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main_container"},[n("div",{staticClass:"home-link-wrap"},[n("router-link",{staticClass:"home-link",attrs:{to:"/"}},[e._v("home")])],1),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"upload-wrap"},[n("input",{staticClass:"file-upload",attrs:{type:"file",minlength:"1"},on:{change:e.upload}})]),e._v(" "),e._m(1)])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fps-wrap"},[n("span",{staticClass:"fps",attrs:{id:"fps"}},[e._v("fps: ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"canvas-wrap",attrs:{id:"animation_container"}},[t("canvas",{staticClass:"webgl canvas",attrs:{id:"canvas"}})])}],!1,null,"62c4645f",null);t.default=component.exports}}]);